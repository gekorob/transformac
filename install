#!/bin/sh

set -e

sudo softwareupdate -ia

echo 'export PATH=/usr/local/bin:/usr/local/sbin:$PATH' > ~/.profile

source $BASEPATH/osx_general
source $BASEPATH/osx_energy_management
source $BASEPATH/osx_finder_setup
source $BASEPATH/osx_dock_setup
source $BASEPATH/osx_trackpad_mouse_setup

killall Finder || true
killall Dock || true
killall SystemUIServer || true


#brew
export HOMEBREW_ANALYTICS=1

# Download and install Homebrew
if [[ ! -x /usr/local/bin/brew ]]; then
    echo "Info   | Install   | homebrew"
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
fi

#xcode
if [ $(xcode-select -p) != "/Applications/Xcode.app/Contents/Developer" ]; then
   echo "cannot find command line tools"
   xcode-select --install
fi
sudo xcodebuild -license accept || true

brew doctor
brew bundle --file="./Brewfile"
xcrun simctl delete unavailable

#font
wget -N -O ~/Library/Fonts/Inconsolata\ for\ Powerline\ Nerd\ Font\ Complete.otf https://raw.githubusercontent.com/ryanoasis/nerd-fonts/master/patched-fonts/Inconsolata/complete/Inconsolata%20for%20Powerline%20Nerd%20Font%20Complete.otf

#atom
source $BASEPATH/atom_setup

#ruby
curl -L https://get.rvm.io | bash -s stable --autolibs=enabled --ruby || true
rvm reload
gem install bundler

#vagrant
source $BASEPATH/vagrant_setup

#nvm
/usr/local/bin/nvm install node
/usr/local/bin/nvm install --lts
/usr/local/bin/nvm alias default node
/usr/local/bin/nvm use default

#powerline
/usr/local/bin/pip install pip
/usr/local/bin/pip install setuptools
/usr/local/bin/pip install psutil
/usr/local/bin/pip install powerline-status
